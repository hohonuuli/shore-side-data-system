<?xml version="1.0"?>
<!--
 Copyright 2009 MBARI
 
 Licensed under the GNU LESSER GENERAL PUBLIC LICENSE, Version 2.1 
 (the "License"); you may not use this file except in compliance 
 with the License. You may obtain a copy of the License at
 
 http://www.gnu.org/copyleft/lesser.html
 
 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->
<project name="ssds-build-core" default="build" basedir=".">

	<!-- Import various path definitions -->
	<import file="path-defs.xml" />

	<!-- Define the ejb-doclet task -->
	<taskdef name="ejbdoclet" classname="xdoclet.modules.ejb.EjbDocletTask">
		<classpath>
			<fileset refid="jboss-common-lib-jar-fileset" />
			<fileset dir="${xdoclet.path}">
				<include name="*.jar" />
			</fileset>
		</classpath>
	</taskdef>

	<!-- Hibernate taskdefs -->
	<taskdef name="hibernatedoclet" classname="xdoclet.modules.hibernate.HibernateDocletTask">
		<classpath>
			<fileset refid="jboss-common-lib-jar-fileset" />
			<fileset dir="${xdoclet.path}">
				<include name="*.jar" />
			</fileset>
		</classpath>
	</taskdef>

	<!-- Define the web-doclet task -->
	<taskdef name="webdoclet" classname="xdoclet.modules.web.WebDocletTask">
		<classpath>
			<fileset refid="jboss-common-lib-jar-fileset" />
			<fileset dir="${xdoclet.path}">
				<include name="*.jar" />
			</fileset>
		</classpath>
	</taskdef>

	<!-- Define the JiBX task -->
	<taskdef name="bind" classname="org.jibx.binding.ant.CompileTask">
		<classpath refid="jibx-classpath" />
	</taskdef>


	<!-- Do stuff that you want everytime ant is run -->
	<target name="init">
		<!-- Initialize the date/time -->
		<tstamp />
	</target>

	<!-- This target removes all the files (and directories if necessary) that -->
	<!-- need to be removed when a clean build is to be done                   -->
	<target name="remove-working-dirs" depends="init">
		<!-- Delete directories where classes are compiled to -->
		<delete dir="${project.build}/classes/moos/ssds/clients/graphing" />
		<delete dir="${project.build}/classes/moos/ssds/clients/updateBot" />
		<delete dir="${project.build}/classes/moos/ssds/data" />
		<delete dir="${project.build}/classes/moos/ssds/metadata" />
		<delete dir="${project.build}/classes/moos/ssds/services/data" />
		<delete dir="${project.build}/classes/moos/ssds/services/metadata" />
		<delete dir="${project.build}/classes/moos/ssds/services/servlet" />
		<delete dir="${project.build}/classes/moos/ssds/services/blazeds" />
		<delete dir="${project.build}/classes/moos/ssds/ingest" />
		<delete dir="${project.build}/classes/moos/ssds/jms" />
		<delete dir="${project.build}/classes/moos/ssds/io" />
		<delete dir="${project.build}/classes/moos/ssds/wrapper" />
		<delete dir="${project.build}/classes/moos/ssds/transmogrify" />
		<delete dir="${project.build}/classes/moos/ssds/util" />
		<delete dir="${project.build}/classes/moos/ssds/dao" />
		<!-- Now delete the configuration directories -->
		<delete dir="${project.build}/metadata" />
		<delete dir="${project.build}/clients/graphing" />
		<delete dir="${project.build}/clients/updateBot" />
		<delete dir="${project.build}/clients/logging" />
		<delete dir="${project.build}/data" />
		<delete dir="${project.build}/servlet" />
		<delete dir="${project.build}/ear" />
		<!-- Delete XDoclet generated code -->
		<delete dir="${src.gen}/moos/ssds/services/data" />
		<delete dir="${src.gen}/moos/ssds/services/metadata" />
		<!-- Delete the Web Services configuration stuff -->
		<delete dir="${project.build}/web-services" />
		<!-- Client publishing jar -->
		<delete dir="${project.build}/client-pub" />
		<!-- Utility jar config -->
		<delete dir="${project.build}/utility" />
	</target>

	<!-- This target rebuilds the appropriate directories by using the project -->
	<!-- directories that are set in the build.properties file.                -->
	<target name="rebuild-project-dirs" depends="init">
		<!-- Base project directories -->
		<mkdir dir="${project.build}" />
		<mkdir dir="${project.build}/classes" />
		<mkdir dir="${project.build}/clients/graphing" />
		<mkdir dir="${project.build}/clients/updateBot" />
		<mkdir dir="${project.build}/clients/logging" />
		<mkdir dir="${project.build}/data/moos/ssds/io" />
		<mkdir dir="${project.build}/data/moos/ssds/services/data" />
		<mkdir dir="${project.build}/metadata/services/META-INF" />
		<mkdir dir="${project.build}/metadata/hibernate/META-INF" />
		<mkdir dir="${project.build}/metadata/moos/ssds/services/metadata" />
		<mkdir dir="${project.build}/metadata/jndi" />
		<mkdir dir="${project.build}/servlet/WEB-INF" />
		<mkdir dir="${project.build}/servlet/mappings" />
		<mkdir dir="${project.build}/ear/META-INF" />
		<mkdir dir="${project.build}/client-pub" />
		<mkdir dir="${project.build}/utility" />
		<mkdir dir="${project.build}/web-services/WEB-INF" />
		<mkdir dir="${project.dist}" />
		<mkdir dir="${src.gen}" />
		<mkdir dir="${gen.doc}" />
		<mkdir dir="${gen.html}" />
		<mkdir dir="${gen.java2html}" />
		<mkdir dir="${gen.test}" />
	</target>

	<!-- The clean targets -->
	<target name="clean" depends="remove-working-dirs,rebuild-project-dirs" />

	<!-- This target runs the XDoclet stuff on the EJB's -->
	<target name="ejb-doclet" depends="init">
		<ejbdoclet ejbspec="${metadata.xdoclet.ejb.spec.version}" destDir="${src.gen}" verbose="${metadata.xdoclet.verbose}" force="${metadata.xdoclet.force}">
			<!-- Include any classes that end in EJB in the metadata package -->
			<fileset dir="${src.java}">
				<include name="moos/ssds/services/data/**/*EJB.java" />
				<include name="moos/ssds/services/metadata/*EJB.java" />
				<include name="moos/ssds/services/metadata/AccessBean.java" />
				<exclude name="moos/ssds/services/data/SQLByteArrayAccessEJB.java"/>
			</fileset>
			<!-- Generate the home and remote interfaces -->
			<homeinterface />
			<remoteinterface />
			<!-- Generate all the local interfaces -->
			<localinterface />
			<localhomeinterface />
			<!-- Create the utility objects -->
			<utilobject kind="physical" />
			<!-- Create the generic J2EE deployment descriptor -->
			<deploymentdescriptor destdir="${project.build}/metadata/services/META-INF" destinationFile="ejb-jar.xml" validatexml="true" />
			<!-- Create the deployment file for jboss -->
			<jboss version="${metadata.xdoclet.jboss.version}" destDir="${project.build}/metadata/services/META-INF" />
		</ejbdoclet>
	</target>

	<!-- This target generates the hibernate deployment files -->
	<target name="hibernate-doclet" depends="init">
		<hibernatedoclet destdir="${project.build}/metadata/hibernate" verbose="${metadata.xdoclet.hibernate.verbose}">
			<fileset dir="${src.java}">
				<include name="moos/ssds/metadata/*.java" />
			</fileset>
			<hibernate version="${metadata.xdoclet.hibernate.version}" destdir="${project.build}/metadata/hibernate" />
		</hibernatedoclet>
	</target>

	<!-- Run the webdoclet task on the various servlets -->
	<target name="web-doclet" depends="init">
		<!-- First copy the merge file that has the JFreeChart servlet specs -->
		<copy file="${resources.build}/servlet/servlet-mappings.template.xml" tofile="${project.build}/servlet/mappings/servlet-mappings.xml" overwrite="true" />

		<!-- Now run webdoclet on servlets and merge in jfreechart stuff -->
		<webdoclet destDir="${src.gen}" mergeDir="${project.build}/servlet/mappings">
			<fileset dir="${src.java}">
				<include name="moos/ssds/services/servlet/**/*Servlet.java" />
			</fileset>
			<!-- generate the generic web.xml -->
			<deploymentdescriptor servletspec="${metadata.xdoclet.servlet.spec.version}" destdir="${project.build}/servlet/WEB-INF" />
			<jbosswebxml securitydomain="java:/jaas/ssds" version="${metadata.xdoclet.servlet.jboss.version}" destDir="${project.build}/servlet/WEB-INF" />
		</webdoclet>
	</target>

	<!-- Now, run ejb doclet on the web services classes -->
	<target name="web-services-doclet" depends="init">
		<ejbdoclet ejbspec="${metadata.xdoclet.ejb.spec.version}" destDir="${src.gen}" verbose="${metadata.xdoclet.verbose}" force="${metadata.xdoclet.force}">
			<!-- Include any classes that end in WS -->
			<fileset dir="${src.java}">
				<include name="moos/ssds/services/metadata/*EJB.java" />
				<include name="moos/ssds/services/data/*EJB.java" />
			</fileset>
			<!-- Create the web service deployment descriptors -->
			<axisdeploy destdir="${project.build}/web-services" />
		</ejbdoclet>
	</target>

	<!-- Compile the metadata source code -->
	<target name="compile" depends="init,ejb-doclet">
		<!-- Run the appropriate javac -->
		<javac destdir="${project.build}/classes" debug="${debug}" fork="yes">
			<src path="${src.java}" />
			<src path="${src.gen}" />
			<include name="moos/ssds/clients/graphing/**/*.java" />
			<include name="moos/ssds/clients/updateBot/**/*.java" />
			<include name="moos/ssds/data/**/*.java" />
			<include name="moos/ssds/metadata/**/*.java" />
			<include name="moos/ssds/services/data/**/*.java" />
			<include name="moos/ssds/services/metadata/**/*.java" />
			<include name="moos/ssds/services/servlet/**/*.java" />
			<include name="moos/ssds/services/blazeds/**/*.java" />
			<include name="moos/ssds/util/**/*.java" />
			<include name="moos/ssds/io/**/*.java" />
			<include name="moos/ssds/wrapper/**/*.java" />
			<include name="moos/ssds/transmogrify/SSDSDevicePacket.java" />
			<include name="moos/ssds/transmogrify/SSDSGeoLocatedDevicePacket.java" />
			<include name="moos/ssds/jms/PublisherComponent.java" />
			<classpath refid="compile-classpath" />
		</javac>
	</target>

	<!-- Generate the JiBX products -->
	<target name="jibx-gen" depends="compile">
		<echo message="Running JiBX binding compiler" />
		<bind binding="${project.src}/xml/binding.xml">
			<classpath refid="jibx-classpath" />
		</bind>
	</target>

	<!-- The target to build -->
	<target name="build" depends="clean,compile,jibx-gen" description="This will clean all the compiled classes, run all the necessary XDoclet tasks, and compile the source code" />

	<!-- The distribution target -->
	<target name="dist" depends="build,hibernate-doclet,web-doclet,web-services-doclet" description="This target runs the clean, compile and then builds this distributions">
		<!-- Delete old server jar files -->
		<delete file="${project.dist}/ssds-metadata.har" />
		<delete file="${project.dist}/ssds-services-metadata.jar" />
		<delete file="${project.dist}/ssds-services-metadata-client.jar" failonerror="false" />
		<delete file="${project.dist}/ssds-graphing-client.jar" failonerror="false" />
		<delete file="${project.dist}/ssds-updateBot-client.jar" failonerror="false" />
		<delete file="${project.dist}/servlet.war" />
		<delete file="${project.dist}/ssds-client-pub.jar" />
		<!-- Delete the web services war -->
		<delete file="${project.dist}/axis.war" />
		<!-- Copy the IO properties file over -->
		<copy file="${resources.build}/moos/ssds/io/io_template.properties" tofile="${project.build}/data/moos/ssds/io/io.properties" overwrite="true">
			<filterset>
				<filter token="IO_STORAGE_DIRECTORY" value="${data.services.io.storage.directory}" />
				<filter token="IO_STORAGE_SQL_JNDI_NAME" value="${data.services.sql.datasource.jndi.name}" />
				<filter token="IO_STORAGE_SQL_JNDI_SERVER_NAME" value="${data.services.sql.datasource.server.name}" />
				<filter token="IO_STORAGE_SQL_USERNAME" value="${data.services.sql.datasource.user.name}" />
				<filter token="IO_STORAGE_SQL_PASSWORD" value="${data.services.sql.datasource.password}" />
				<filter token="IO_STORAGE_SQL_CREATE_DEVICE_TABLE" value="${io.storage.sql.create.device.table}" />
				<filter token="IO_STORAGE_SQL_CREATE_DEVICE_TABLE_PRIMARY_KEY" value="${io.storage.sql.create.device.table.primary.key}" />
				<filter token="IO_STORAGE_SQL_CREATE_DEVICE_TABLE_INDEX" value="${io.storage.sql.create.device.table.index}" />
				<filter token="IO_STORAGE_SQL_TEMPLATE_FIND_TABLE" value="${io.storage.sql.template.find.table}" />
				<filter token="IO_STORAGE_SQL_TEMPLATE_COUNT_NUMBER_OF_ROWS" value="${io.storage.sql.template.count.number.of.rows}" />
				<filter token="IO_STORAGE_SQL_TEMPLATE_COUNT_NUMBER_OF_ROWS_WITH_RECORD_TYPE" value="${io.storage.sql.template.count.number.of.rows.with.record.type}" />
				<filter token="IO_STORAGE_SQL_TEMPLATE_LATEST_TIMESTAMP_SECONDS" value="${io.storage.sql.template.latest.timestamp.seconds}" />
				<filter token="IO_STORAGE_SQL_TEMPLATE_LATEST_TIMESTAMP_SECONDS_WITH_RECORD_TYPE" value="${io.storage.sql.template.latest.timestamp.seconds.with.record.type}" />
				<filter token="IO_STORAGE_SQL_TEMPLATE_LATEST_TIMESTAMP_NANOSECONDS" value="${io.storage.sql.template.latest.timestamp.nanoseconds}" />
				<filter token="IO_STORAGE_SQL_TEMPLATE_LATEST_TIMESTAMP_NANOSECONDS_WITH_RECORD_TYPE" value="${io.storage.sql.template.latest.timestamp.nanoseconds.with.record.type}" />
				<filter token="IO_STORAGE_SQL_TEMPLATE_SELECT_PACKETS_BY_TIME" value="${io.storage.sql.template.select.packets.by.time}" />
				<filter token="IO_STORAGE_SQL_TEMPLATE_SELECT_PACKETS_BY_TIME_WITH_RECORD_TYPE" value="${io.storage.sql.template.select.packets.by.time.with.record.type}" />
				<filter token="IO_STORAGE_SQL_TABLE_DELIMITER" value="${io.storage.sql.table.delimiter}" />
				<filter token="IO_STORAGE_SQL_LASTNUMBER_PREAMBLE" value="${io.storage.sql.lastnumber.preamble}" />
				<filter token="IO_STORAGE_SQL_LASTNUMBER_POSTAMBLE" value="${io.storage.sql.lastnumber.postamble}" />
			</filterset>
		</copy>
		<!-- Copy the DAO properties file over -->
		<copy file="${resources.build}/moos/ssds/dao/dao_template.properties" tofile="${project.build}/metadata/moos/ssds/dao/dao.properties" overwrite="true">
			<filterset>
				<filter token="METADATA_DAO_HOST_ETHERNET_ADDRESS" value="${metadata.dao.host.ethernet.address}" />
				<filter token="METADATA_DAO_SSDS_ADMIN_TO_EMAIL_ADDRESS" value="${core.mail.system.messages.to}" />
				<filter token="METADATA_DATA_SSDS_USER_EMAIL_MESSAGES" value="${core.mail.user.messages}" />
			</filterset>
		</copy>
		<!-- Copy the services properties file over -->
		<copy file="${resources.build}/moos/ssds/services/metadata/servicesMetadata_template.properties" tofile="${project.build}/metadata/moos/ssds/services/metadata/servicesMetadata.properties" overwrite="true">
			<filterset>
				<filter token="METADATA_HIBERNATE_JNDI_NAME" value="${metadata.hibernate.jndi.name}" />
				<filter token="METADATA_SERVICES_MAIL_SESSION_JNDI_NAME" value="${core.mail.jndi.name}" />
				<filter token="METADATA_SERVICES_SEND_EMAIL_MESSAGES" value="${core.mail.system.messages}" />
				<filter token="METADATA_SERVICES_ADMIN_FROM_EMAIL_ADDRESS" value="${core.mail.from}" />
			</filterset>
		</copy>
		<copy file="${resources.build}/moos/ssds/services/data/servicesData_template.properties" tofile="${project.build}/data/moos/ssds/services/data/servicesData.properties" overwrite="true">
			<filterset>
				<filter token="DATA_SERVICES_GPS_GRAPH_LOCATION" value="${data.services.gps.graph.location}" />
				<filter token="DATA_SERVICES_GPS_GRAPH_URL_BASE" value="${data.services.gps.graph.url.base}" />
			</filterset>
		</copy>
		<!-- Copy supporting files and images over to build/classes -->
		<copy file="${src.java}/moos/ssds/data/graphing/anchor.gif" tofile="${build.classes}/moos/ssds/data/graphing/anchor.gif" overwrite="true" />
		<!-- First copy the Hibernate HAR service descriptor to the config location -->
		<copy file="${resources.build}/jboss/hibernate-service.xml" tofile="${project.build}/metadata/hibernate/META-INF/hibernate-service.xml" overwrite="true">
			<filterset>
				<filter token="METADATA_HIBERNATE_SERVICE_NAME" value="${metadata.hibernate.service.name}" />
				<filter token="METADATA_HIBERNATE_DATASOURCE_JNDI_NAME" value="${metadata.datasource.jndi.name}" />
				<filter token="METADATA_HIBERNATE_DIALECT" value="${metadata.hibernate.dialect}" />
				<filter token="METADATA_HIBERNATE_JNDI_NAME" value="${metadata.hibernate.jndi.name}" />
				<filter token="METADATA_HIBERNATE_CACHE_PROVIDER_CLASS" value="${metadata.hibernate.cache.provider.class}" />
				<filter token="METADATA_HIBERNATE_HBM2DDLAUTO" value="${metadata.hibernate.hbm2ddlauto}" />
				<filter token="METADATA_HIBERNATE_DEFAULT_SCHEMA" value="${metadata.hibernate.default.schema}" />
			</filterset>
		</copy>
		<!-- Copy the graphing properties file over -->
		<copy file="${resources.build}/moos/ssds/clients/graphing/graphing_template.properties" tofile="${project.build}/clients/graphing/moos/ssds/clients/graphing/graphing.properties" overwrite="true">
			<filterset>
				<filter token="CLIENT_GRAPHING_DEVICE_QC_PLOT_DIRECTORY" value="${client.graphing.device.qc.plot.directory}" />
				<filter token="CLIENT_GRAPHING_DEVICE_QC_PLOT_URLBASE" value="${client.graphing.device.qc.plot.urlbase}" />
				<filter token="CLIENT_GRAPHING_DEVICE_QC_PLOT_DATABASE_JDBC_CLASS_NAME" value="${client.graphing.device.qc.plot.database.jdbc.class.name}" />
				<filter token="CLIENT_GRAPHING_DEVICE_QC_PLOT_DATABASE_JDBC_URL" value="${client.graphing.device.qc.plot.database.jdbc.url}" />
				<filter token="CLIENT_GRAPHING_DEVICE_QC_PLOT_DATABASE_USERNAME" value="${client.graphing.device.qc.plot.database.username}" />
				<filter token="CLIENT_GRAPHING_DEVICE_QC_PLOT_DATABASE_PASSWORD" value="${client.graphing.device.qc.plot.database.password}" />
			</filterset>
		</copy>
		<!-- Copy the updateBot properties file over -->
		<copy file="${resources.build}/moos/ssds/clients/updateBot/updateBot_template.properties" tofile="${project.build}/clients/updateBot/moos/ssds/clients/updateBot/updateBot.properties" overwrite="true">
			<filterset>
				<filter token="CLIENT_UPDATEBOT_NETCDF_BASE_WORKING_DIRECTORY" value="${client.updateBot.netcdf.base.working.directory}" />
				<filter token="CLIENT_UPDATEBOT_NETCDF_BASE_DIRECTORY" value="${client.updateBot.netcdf.base.directory}" />
				<filter token="CLIENT_UDPATEBOT_NETCDF_URLBASE" value="${client.updateBot.netcdf.urlbase}" />
				<filter token="CLIENT_UDPATEBOT_DODS_URLBASE" value="${client.updateBot.dods.urlbase}" />
				<filter token="CLIENT_UPDATEBOT_DATABASE_JDBC_CLASS_NAME" value="${client.updateBot.database.jdbc.class.name}" />
				<filter token="CLIENT_UPDATEBOT_DATABASE_JDBC_URL" value="${client.updateBot.database.jdbc.url}" />
				<filter token="CLIENT_UDPATEBOT_DATABASE_USERNAME" value="${client.updateBot.database.username}" />
				<filter token="CLIENT_UPDATEBOT_DATABASE_PASSWORD" value="${client.updateBot.database.password}" />
				<filter token="CLIENT_UPDATEBOT_MAIL_HOST" value="${client.updateBot.mail.host}" />
				<filter token="CLIENT_UPDATEBOT_SEND_USER_EMAIL" value="${client.updateBot.send.user.email}" />
				<filter token="CLIENT_UPDATEBOT_SEND_ADMIN_EMAIL" value="${client.updateBot.send.admin.email}" />
				<filter token="CLIENT_UDPATEBOT_ADMIN_EMAIL_ADDRESS" value="${client.updateBot.admin.email.address}" />
				<filter token="CLIENT_UDPATEBOT_SUBSCRIBER_HOST_NAME_LONG" value="${client.updateBot.subscriber.host.name.long}" />
				<filter token="CLIENT_UDPATEBOT_SUBSCRIBER_TOPIC_NAME" value="${client.updateBot.subscriber.topic.name}" />
				<filter token="CLIENT_UDPATEBOT_SLEEP_TIME_SECONDS" value="${client.updateBot.sleep.time.seconds}" />
			</filterset>
		</copy>
		<!-- Now put in into a HAR file -->
		<jar jarfile="${project.dist}/ssds-metadata.har">
			<!-- Include the class -->
			<fileset dir="${project.build}/classes">
				<include name="moos/ssds/metadata/**/*.class" />
				<include name="moos/ssds/util/**/*.class" />
			</fileset>
			<!-- Include the metadata for the generic deployment descriptor -->
			<fileset dir="${project.build}/metadata/hibernate">
				<include name="META-INF/*.xml" />
				<include name="moos/ssds/metadata/**/*.xml" />
			</fileset>
		</jar>
		<!-- Now create the services jar file -->
		<jar jarfile="${project.dist}/ssds-services-metadata.jar">
			<!-- Include the class -->
			<fileset dir="${project.build}/classes">
				<include name="moos/ssds/dao/**/*.class" />
				<include name="moos/ssds/data/**/*.class" />
				<include name="moos/ssds/data/graphing/*.gif" />
				<include name="moos/ssds/services/data/**/*.class" />
				<include name="moos/ssds/services/metadata/**/*.class" />
				<include name="moos/ssds/services/blazeds/**/*.class" />
				<include name="moos/ssds/util/**/*.class" />
				<include name="moos/ssds/io/**/*.class" />
				<include name="moos/ssds/wrapper/**/*.class" />
				<include name="moos/ssds/transmogrify/SSDSDevicePacket.class" />
				<include name="moos/ssds/transmogrify/SSDSGeoLocatedDevicePacket.class" />
				<include name="org/mbari/util/**/*.class" />
			</fileset>
			<!-- Include the metadata for the generic deployment descriptor -->
			<fileset dir="${project.build}/metadata/services">
				<include name="META-INF/*.xml" />
			</fileset>
			<fileset dir="${project.build}/data">
				<include name="moos/ssds/io/**/*.properties" />
				<include name="moos/ssds/services/data/**/*.properties" />
			</fileset>
			<fileset dir="${project.build}/metadata">
				<include name="moos/ssds/services/metadata/**/*.properties" />
			</fileset>
			<fileset dir="${project.build}/metadata">
				<include name="moos/ssds/dao/**/*.properties" />
			</fileset>
		</jar>
		<!-- Create a patternset for later use -->
		<patternset id="java.source.patternset">
			<include name="**/*.java" />
			<exclude name="moos/ssds/jms/**/*.java" />
			<exclude name="moos/ssds/ingest/**/*.java" />
			<exclude name="moos/ssds/*.java" />
			<exclude name="moos/ssds/access/**/*.java" />
			<exclude name="moos/ssds/clients/**/*.java" />
			<exclude name="moos/ssds/cimt/**/*.java" />
			<exclude name="moos/ssds/dao/**/*.java" />
			<exclude name="moos/ssds/ruminate/**/*.java" />
			<exclude name="moos/ssds/services/servlet/**/*.java" />
			<exclude name="moos/ssds/simulator/**/*.java" />
			<exclude name="moos/ssds/tasks/**/*.java" />
			<exclude name="moos/ssds/transmogrify/**/*.java" />
			<exclude name="moos/ssds/wrappergenerator/**/*.java" />
			<exclude name="test/**/*.java" />
		</patternset>
		<!-- Create the client jar(s) -->
		<!-- Copy over the jndi.properties file -->
		<copy file="${resources.build}/jboss/jndi.properties" tofile="${project.build}/metadata/jndi/jndi.properties" overwrite="true">
			<filterset>
				<filter token="SERVER_NAME" value="${metadata.services.host.name.long}" />
			</filterset>
		</copy>
		<!-- log4j properties -->
		<copy file="${src.resources}/build/log4j/log4j_FileAppender_Template.properties" tofile="${project.build}/clients/logging/log4j.properties" overwrite="true">
			<filterset>
				<filter token="LOG4J_LEVEL" value="${client.log4j.level}" />
				<filter token="LOG4J_FILE_NAME" value="${client.log4j.file.name}" />
				<filter token="LOG4J_DATE_PATTERN" value="${client.log4j.date.pattern}" />
				<filter token="LOG4J_PATTERN_LAYOUT" value="${client.log4j.pattern.layout}" />
			</filterset>
		</copy>
		<jar jarfile="${project.dist}/ssds-services-metadata-client.jar">
			<!-- Include the class -->
			<fileset dir="${project.build}/classes">
				<include name="moos/ssds/io/**/*.class" />
				<include name="moos/ssds/dao/*.class" />
				<include name="moos/ssds/data/**/*.class" />
				<include name="moos/ssds/metadata/**/*.class" />
				<include name="moos/ssds/services/metadata/**/*.class" />
				<include name="moos/ssds/dao/util/*Exception.class" />
				<include name="moos/ssds/util/**/*.class" />
				<include name="moos/ssds/services/data/**/*.class" />
				<include name="moos/ssds/wrapper/**/*.class" />
				<include name="moos/ssds/transmogrify/SSDSDevicePacket.class" />
				<include name="moos/ssds/transmogrify/SSDSGeoLocatedDevicePacket.class" />
			</fileset>
			<!-- The JNDI properties file -->
			<fileset dir="${project.build}/metadata/jndi" includes="jndi.properties" />
			<!-- The log4j properties file -->
			<fileset dir="${project.build}/clients/logging" includes="log4j.properties" />
			<!-- The source code (if needed) -->
			<fileset dir="${project.src}/java">
				<patternset refid="java.source.patternset" />
			</fileset>
			<fileset dir="${project.src}/gen">
				<patternset refid="java.source.patternset" />
			</fileset>
		</jar>
		<!-- Create the log4j.properties for the graph creation stuff -->
		<copy file="${src.resources}/build/log4j/log4j_FileAppender_Template.properties" tofile="${project.build}/clients/graphing/log4j.properties" overwrite="true">
			<filterset>
				<filter token="LOG4J_LEVEL" value="${client.graphing.log4j.level}" />
				<filter token="LOG4J_FILE_NAME" value="${client.graphing.log4j.file.name}" />
				<filter token="LOG4J_DATE_PATTERN" value="${client.graphing.log4j.date.pattern}" />
				<filter token="LOG4J_PATTERN_LAYOUT" value="${client.graphing.log4j.pattern.layout}" />
			</filterset>
		</copy>
		<!-- The Manifest File for it -->
		<copy file="${resources.build}/manifest/MANIFEST_TEMPLATE.MF" tofile="${project.build}/clients/graphing/MANIFEST.MF" overwrite="true">
			<filterset>
				<filter token="CLASSPATH" value="${client.graphing.classpath}" />
				<filter token="MAIN_CLASS_STATEMENT" value="Main-Class: ${client.graphing.main.class}" />
			</filterset>
		</copy>
		<!-- Now construct the graphing client jar -->
		<jar jarfile="${project.dist}/ssds-graphing-client.jar" manifest="${project.build}/clients/graphing/MANIFEST.MF">
			<!-- Include the class -->
			<fileset dir="${project.build}/classes">
				<include name="moos/ssds/clients/graphing/**/*.class" />
				<include name="moos/ssds/data/**/*.class" />
				<include name="moos/ssds/metadata/**/*.class" />
				<include name="moos/ssds/services/metadata/**/*.class" />
				<include name="moos/ssds/dao/util/*Exception.class" />
				<include name="moos/ssds/util/**/*.class" />
				<include name="moos/ssds/wrapper/**/*.class" />
				<include name="moos/ssds/services/data/**/*.class" />
				<include name="moos/ssds/transmogrify/SSDSDevicePacket.class" />
				<include name="moos/ssds/transmogrify/SSDSGeoLocatedDevicePacket.class" />
			</fileset>
			<!-- The JNDI properties file -->
			<fileset dir="${project.build}/metadata/jndi" includes="jndi.properties" />
			<!-- The log4j properties file -->
			<fileset dir="${project.build}/clients/graphing" includes="log4j.properties" />
			<!-- The source code (if needed) -->
			<fileset dir="${project.src}/java">
				<patternset refid="java.source.patternset" />
			</fileset>
			<fileset dir="${project.src}/gen">
				<patternset refid="java.source.patternset" />
			</fileset>
			<!-- The graphing properites -->
			<fileset dir="${project.build}/clients/graphing" includes="moos/ssds/clients/graphing/graphing.properties" />
		</jar>
		<!-- Create the log4j.properties for the udpateBot stuff -->
		<copy file="${src.resources}/build/log4j/log4j_FileAppender_Template.properties" tofile="${project.build}/clients/updateBot/log4j.properties" overwrite="true">
			<filterset>
				<filter token="LOG4J_LEVEL" value="${client.updateBot.log4j.level}" />
				<filter token="LOG4J_FILE_NAME" value="${client.updateBot.log4j.file.name}" />
				<filter token="LOG4J_DATE_PATTERN" value="${client.updateBot.log4j.date.pattern}" />
				<filter token="LOG4J_PATTERN_LAYOUT" value="${client.updateBot.log4j.pattern.layout}" />
			</filterset>
		</copy>
		<!-- The Manifest File for it -->
		<copy file="${resources.build}/manifest/MANIFEST_TEMPLATE.MF" tofile="${project.build}/clients/updateBot/MANIFEST.MF" overwrite="true">
			<filterset>
				<filter token="CLASSPATH" value="${client.updatebot.classpath}" />
				<filter token="MAIN_CLASS_STATEMENT" value="Main-Class: ${client.updatebot.main.class}" />
			</filterset>
		</copy>
		<!-- Copy the JMS Properties -->
		<copy file="${resources.build}/moos/ssds/jms/jms_template.properties" tofile="${project.build}/client-pub/moos/ssds/jms/jms.properties" overwrite="true">
			<filterset>
				<filter token="JMS_TOPIC" value="${client.updateBot.subscriber.topic.name}" />
				<filter token="JMS_TOPIC_CONNECTION_FACTORY_JNDI_NAME" value="${client.publisher.jms.topic.connection.factory.jndi.name}" />
			</filterset>
		</copy>
		<!-- Now construct the udpateBot client jar -->
		<jar jarfile="${project.dist}/ssds-updateBot-client.jar" manifest="${project.build}/clients/updateBot/MANIFEST.MF">
			<!-- Include the class -->
			<fileset dir="${project.build}/classes">
				<include name="moos/ssds/jms/Subscriber*.class" />
				<include name="moos/ssds/clients/updateBot/**/*.class" />
				<include name="moos/ssds/data/**/*.class" />
				<include name="moos/ssds/metadata/**/*.class" />
				<include name="moos/ssds/services/metadata/**/*.class" />
				<include name="moos/ssds/dao/util/*Exception.class" />
				<include name="moos/ssds/util/**/*.class" />
				<include name="org/mbari/util/**/*.class" />
				<include name="moos/ssds/wrapper/**/*.class" />
			</fileset>
			<!-- The JMS properties file -->
			<fileset dir="${project.build}/client-pub" includes="moos/ssds/jms/jms.properties" />
			<!-- The JNDI properties file -->
			<fileset dir="${project.build}/metadata/jndi" includes="jndi.properties" />
			<!-- The log4j properties file -->
			<fileset dir="${project.build}/clients/updateBot" includes="log4j.properties" />
			<!-- The source code (if needed) -->
			<fileset dir="${project.src}/java">
				<patternset refid="java.source.patternset" />
			</fileset>
			<fileset dir="${project.src}/gen">
				<patternset refid="java.source.patternset" />
			</fileset>
			<!-- The graphing properites -->
			<fileset dir="${project.build}/clients/updateBot" includes="moos/ssds/clients/updateBot/updateBot.properties" />
		</jar>
		<!-- Now construct the web services war file -->
		<!-- Strip all the deployment information from the deployment descriptors so they can be merged -->
		<replaceregexp match=".*xml version.*|.*deployment.*|.*xmlns.*" replace="" flags="g">
			<fileset dir="${project.build}/web-services">
				<include name="**/*.xml" />
			</fileset>
		</replaceregexp>
		<!-- Copy over the top part of the wsdd file for Apache Axis -->
		<concat destfile="${project.build}/web-services/WEB-INF/server-config.wsdd" append="false">
			<filelist dir="${project.src}/resources/build/web-services" files="server-config.wsdd" />
		</concat>
		<!-- Now concatenate that with the web service deployment descriptors -->
		<concat destfile="${project.build}/web-services/WEB-INF/server-config.wsdd" append="true">
			<fileset dir="${project.build}/web-services">
				<include name="**/*.xml" />
			</fileset>
		</concat>
		<!-- Now concatenate (add) the footer portion of the Axis deployment template -->
		<concat destfile="${project.build}/web-services/WEB-INF/server-config.wsdd" append="true">
			<filelist dir="${project.src}/resources/build/web-services" files="server-config.wsdd.end" />
		</concat>
		<!-- Build the SSDS web services war file for the current server -->
		<war destfile="${project.dist}/axis.war" webxml="${project.src}/resources/build/web-services/web.xml">
			<fileset dir="${project.build}/web-services">
				<include name="WEB-INF/server-config.wsdd" />
			</fileset>
			<lib file="${project.lib}/${axis.jar}" />
			<lib file="${project.lib}/${jaxrpc.jar}" />
			<lib file="${project.lib}/${wsdl4j.jar}" />
			<lib file="${project.lib}/${apache.commons.discovery}" />
		</war>
		<!-- Build the SSDS servlet services war file for the current server -->
		<war destfile="${project.dist}/servlet.war" webxml="${project.build}/servlet/WEB-INF/web.xml">
			<classes dir="${build.classes}">
				<include name="moos/ssds/services/servlet/**/*.class" />
			</classes>
			<webinf dir="${project.build}/servlet/WEB-INF" includes="jboss-web.xml" />
			<webinf dir="${resources.build}/flex/WEB-INF" includes="*.xml" />
			<webinf dir="${resources.build}/flex/WEB-INF" includes="flex/*.xml" />
		</war>
		<!-- Copy the MANIFEST.MF, application.xml and jboss-app.xml for the EAR file -->
		<copy file="${resources.build}/manifest/MANIFEST_TEMPLATE.MF" tofile="${project.build}/ear/MANIFEST.MF" overwrite="true">
			<filterset>
				<filter token="CLASSPATH" value="${core.ear.classpath}" />
				<filter token="MAIN_CLASS_STATEMENT" value="" />
			</filterset>
		</copy>
		<copy file="${resources.build}/jboss/application.xml" tofile="${project.build}/ear/application.xml" overwrite="true" />
		<copy file="${resources.build}/jboss/jboss-app.xml" tofile="${project.build}/ear/META-INF/jboss-app.xml" overwrite="true" />
		<!-- Now create the EAR file -->
		<ear destfile="${project.dist}/ssds.ear" appxml="${project.build}/ear/application.xml" manifest="${project.build}/ear/MANIFEST.MF">
			<fileset file="${project.dist}/ssds-services-metadata.jar" />
			<fileset file="${project.dist}/ssds-metadata.har" />
			<fileset file="${project.dist}/servlet.war" />
			<fileset refid="all-project-lib-jar-fileset" />
			<fileset dir="${project.build}/ear">
				<include name="META-INF/jboss-app.xml" />
			</fileset>
		</ear>
	</target>

	<!-- The target to test the metdata services -->
	<target name="test" depends="init">
		<!-- First check to see if the client jar has been built -->
		<!-- If not, call the target to build it -->
		<condition property="client.jar.exists">
			<available file="${project.dist}/ssds-services-metadata-client.jar" type="file" />
		</condition>
		<fail unless="client.jar.exists" message="Please run dist target first to build client jar" />
		<!-- Clean out the compiled test classes -->
		<delete dir="${project.build}/classes/test/moos/ssds/metadata" />
		<delete dir="${project.build}/classes/test/moos/ssds/services/metadata" />
		<!-- Compile just the test classes -->
		<javac destdir="${project.build}/classes" debug="${debug}" fork="yes">
			<src path="${src.java}" />
			<include name="test/moos/ssds/data/**/*.java" />
			<include name="test/moos/ssds/services/metadata/**/*.java" />
			<include name="test/moos/ssds/services/data/**/*.java" />
			<include name="test/moos/ssds/metadata/**/*.java" />
			<include name="test/moos/ssds/util/**/*.java" />
			<include name="test/moos/ssds/wrapper/**/*.java" />
			<classpath>
				<pathelement location="${project.dist}/ssds-services-metadata-client.jar" />
				<pathelement location="${project.build}/classes" />
				<pathelement location="${project.lib}/${xmlunit.jar}" />
				<pathelement location="${project.lib}/${junit.jar}" />
				<path refid="compile-classpath" />
			</classpath>
		</javac>
		<!-- Copy the appropriate resources needed for tests to the classpath directories -->
		<copy file="${src.resources}/test/moos/ssds/metadata/util/TestObjectBuilder.xml" tofile="${project.build}/classes/test/moos/ssds/metadata/util/TestObjectBuilder.xml" overwrite="true" />
		<!-- Now run all the tests -->
		<junit printsummary="withOutAndErr" haltonfailure="no" errorProperty="test.failed" failureProperty="test.failed">
			<jvmarg value="-Xms512m" />
			<jvmarg value="-Xmx1024m" />
			<classpath>
				<pathelement location="${project.dist}/ssds-services-metadata-client.jar" />
				<pathelement location="${project.build}/classes" />
				<pathelement location="${project.lib}/${xmlunit.jar}" />
				<pathelement location="${project.lib}/${junit.jar}" />
				<path refid="compile-classpath" />
			</classpath>
			<formatter type="xml" />
			<batchtest fork="yes" todir="${gen.test}">
				<fileset dir="${src.java}">
					<!-- Test the metadata classes -->
					<include name="test/moos/ssds/metadata/**/*Test*.java" />

					<!-- Test the data parsers -->
					<include name="test/moos/ssds/data/parsers/**/*Test*.java" />

					<!-- Test the services for the metadata classes -->
					<include name="test/moos/ssds/services/metadata/TestEventAccess.java" />
					<include name="test/moos/ssds/services/metadata/TestKeywordAccess.java" />
					<include name="test/moos/ssds/services/metadata/TestPersonAccess.java" />

					<!-- <include name="test/moos/ssds/services/metadata/**/*Test*.java" />  -->
					<!-- Exclude the parent test class
					<exclude name="test/moos/ssds/services/metadata/TestAccessCase.java" /> -->

					<!-- Individual service tests (turn off if using the test in the previous line) -->
					<!-- <include name="test/moos/ssds/services/metadata/TestDataContainerAccess.java" /> -->
					<!-- <include name="test/moos/ssds/services/metadata/TestDataProducerAccess.java" /> -->
					<!-- <include name="test/moos/ssds/services/metadata/TestDeviceAccess.java" /> -->
					<!-- <include name="test/moos/ssds/services/metadata/TestDeviceTypeAccess.java" /> -->
					<!-- <include name="test/moos/ssds/services/metadata/TestStandardUnitAccess.java" /> -->
					<!-- <include name="test/moos/ssds/services/metadata/TestStandardVariableAccess.java" /> -->

					<!-- Test the data services
					<include name="test/moos/ssds/services/data/**/*Test*.java" /> -->

					<!-- Utility tests -->
					<include name="test/moos/ssds/util/**/*Test*.java" />

				</fileset>
			</batchtest>
		</junit>
		<!--		<fail message="Tests failed! Please check test reports" if="test.failed" /> -->
	</target>

	<!-- Deploy everything -->
	<target name="deploy" depends="dist">
		<!-- Copy the security deployment files over -->
		<copy file="${resources.build}/jboss/ssds-login-config.xml" todir="${security.config.deployment.location}" overwrite="true">
			<filterset>
				<filter token="JAVA_NAMING_FACTORY_INITIAL" value="${java.naming.factory.initial}" />
				<filter token="JAVA_NAMING_PROVIDER_URL" value="${java.naming.provider.url}" />
				<filter token="JAVA_NAMING_SECURITY_AUTHENTICATION" value="${java.naming.security.authentication}" />
				<filter token="BINDDN" value="${bindDN}" />
				<filter token="BINDCREDENTIAL" value="${bindCredential}" />
				<filter token="BASECTXDN" value="${baseCtxDN}" />
				<filter token="BASEFILTER" value="${baseFilter}" />
				<filter token="ROLESCTXDN" value="${rolesCtxDN}" />
				<filter token="ROLEFILTER" value="${roleFilter}" />
				<filter token="ROLEATTRIBUTEID" value="${roleAttributeID}" />
				<filter token="ROLEATTRIBUTEISDN" value="${roleAttributeIsDN}" />
				<filter token="ROLENAMEATTRIBUTEID" value="${roleNameAttributeID}" />
				<filter token="ROLERECURSION" value="${roleRecursion}" />
				<filter token="SEARCHSCOPE" value="${searchScope}" />
				<filter token="ALLOWEMPTYPASSWORDS" value="${allowEmptyPasswords}" />
			</filterset>
		</copy>
		<copy file="${resources.build}/jboss/ssds-login-config-service.xml" todir="${security.config.service.deployment.location}" overwrite="true" />
		<!-- Copy the mail configuration file over -->
		<copy file="${resources.build}/jboss/mail-service.xml" todir="${core.mail.deployment.location}" overwrite="true">
			<filterset>
				<filter token="CORE_MAIL_STORE_PROTOCOL" value="${core.mail.store.protocol}" />
				<filter token="CORE_MAIL_TRANSPORT_PROTOCOL" value="${core.mail.transport.protocol}" />
				<filter token="CORE_MAIL_POP3_HOST" value="${core.mail.pop3.host}" />
				<filter token="CORE_MAIL_SMTP_HOST" value="${core.mail.smtp.host}" />
				<filter token="CORE_MAIL_FROM" value="${core.mail.from}" />
				<filter token="CORE_MAIL_DEBUG" value="${core.mail.debug}" />
			</filterset>
		</copy>
		<!-- Deploy the JDBC driver jar -->
		<copy file="${project.lib}/${metadata.datasource.jdbc.jar}" todir="${jboss.home}/server/${jboss.server.type}/lib" />
		<!-- Deploy the Flex Tomcat Security jars -->
		<copy file="${project.lib}/${blazeds.flex.tomcat.common.jar}" todir="${jboss.home}/server/${jboss.server.type}/lib" />
		<copy file="${project.lib}/${blazeds.flex.tomcat.server.jar}" todir="${jboss.home}/server/${jboss.server.type}/lib" />
		<!-- Copy data DataSource xml configurations over -->
		<copy file="${resources.build}/jboss/ssds-ds_template.xml" tofile="${jboss.home}/server/${jboss.server.type}/deploy/ssds-data-ds.xml" overwrite="true">
			<filterset>
				<filter token="DATASOURCE_JNDI_NAME" value="${data.services.sql.datasource.jndi.name}" />
				<filter token="DATASOURCE_CONNECTION_URL" value="${data.services.sql.datasource.connection.url}" />
				<filter token="DATASOURCE_DRIVER_CLASS" value="${data.services.sql.datasource.driver.class}" />
				<filter token="DATASOURCE_USER_LOGIN_NAME" value="${data.services.sql.datasource.user.name}" />
				<filter token="DATASOURCE_PASSWORD" value="${data.services.sql.datasource.password}" />
				<filter token="DATASOURCE_TRANSACTION_ISOLATION" value="${data.services.sql.datasource.transaction.isolation}" />
				<filter token="DATASOURCE_TYPE_MAPPING" value="${database.driver.type.mapping}" />
			</filterset>
		</copy>
		<!-- Copy metadata DataSource xml configurations over -->
		<copy file="${resources.build}/jboss/ssds-ds_template.xml" tofile="${jboss.home}/server/${jboss.server.type}/deploy/ssds-metadata-ds.xml" overwrite="true">
			<filterset>
				<filter token="DATASOURCE_JNDI_NAME" value="${metadata.datasource.jndi.name}" />
				<filter token="DATASOURCE_CONNECTION_URL" value="${metadata.datasource.connection.url}" />
				<filter token="DATASOURCE_DRIVER_CLASS" value="${metadata.datasource.driver.class}" />
				<filter token="DATASOURCE_USER_LOGIN_NAME" value="${metadata.datasource.user.name}" />
				<filter token="DATASOURCE_PASSWORD" value="${metadata.datasource.password}" />
				<filter token="DATASOURCE_TRANSACTION_ISOLATION" value="${metadata.datasource.transaction.isolation}" />
				<filter token="DATASOURCE_TYPE_MAPPING" value="${metadata.datasource.type.mapping}" />
			</filterset>
		</copy>
		<!-- Now deploy the EAR -->
		<copy file="${project.dist}/ssds.ear" todir="${jboss.home}/server/${jboss.server.type}/deploy" />
		<!-- Copy over the web services war -->
		<copy file="${project.dist}/axis.war" todir="${jboss.home}/server/${jboss.server.type}/deploy" />
		<!-- Make sure the ssds-docs directory is there -->
		<mkdir dir="${project.documentation.deploy.location}" />
		<mkdir dir="${project.documentation.deploy.location}/client" />
		<mkdir dir="${project.documentation.deploy.location}/xml" />
		<mkdir dir="${project.documentation.deploy.location}/xml/schema" />

		<!-- Now deploy the graphing app jar -->
		<delete dir="${project.dist}/tempzip" />
		<mkdir dir="${project.dist}/tempzip" />
		<copy file="${resources.build}/doc/client/README_graphing_client.html" tofile="${project.dist}/tempzip/README.html" overwrite="true" />
		<zip destfile="${project.documentation.deploy.location}/client/ssds-graphing-client.zip">
			<fileset dir="${project.dist}/tempzip" includes="README.html" />
			<fileset dir="${project.dist}" includes="ssds-graphing-client.jar" />
			<zipfileset refid="jboss-client-jar-fileset" prefix="lib" />
			<zipfileset refid="jboss-lib-jar-fileset" prefix="lib" />
			<zipfileset refid="all-project-lib-flattened-jar-fileset" prefix="lib" />
			<zipfileset dir="${project.lib}" includes="${client.graphing.device.qc.plot.jdbc.jar}" prefix="lib" />
		</zip>

		<!-- Now deploy the updateBot app jar -->
		<delete dir="${project.dist}/tempzip" />
		<mkdir dir="${project.dist}/tempzip" />
		<copy file="${resources.build}/doc/client/README_updateBot_client.html" tofile="${project.dist}/tempzip/README.html" overwrite="true" />
		<zip destfile="${project.documentation.deploy.location}/client/ssds-updateBot-client.zip">
			<fileset dir="${project.dist}/tempzip" includes="README.html" />
			<fileset dir="${project.dist}" includes="ssds-updatebot-client.jar" />
			<zipfileset refid="jboss-client-jar-fileset" prefix="lib" />
			<zipfileset refid="jboss-lib-jar-fileset" prefix="lib" />
			<zipfileset refid="all-project-lib-flattened-jar-fileset" prefix="lib" />
			<zipfileset dir="${project.lib}" includes="${client.updateBot.jdbc.jar}" prefix="lib" />
		</zip>

		<!-- Now zip up and deploy the client file -->
		<delete dir="${project.dist}/tempzip" />
		<mkdir dir="${project.dist}/tempzip" />
		<copy file="${resources.build}/doc/client/README.html" tofile="${project.dist}/tempzip/README.html" overwrite="true">
			<filterset>
				<filter token="CLIENT_CLASSPATH" value="${client.classpath}" />
			</filterset>
		</copy>
		<zip destfile="${project.documentation.deploy.location}/client/ssds-services-metadata-client.zip">
			<fileset dir="${project.dist}/tempzip" includes="README.html" />
			<fileset dir="${project.dist}" includes="ssds-services-metadata-client.jar" />
			<fileset refid="jboss-client-jar-fileset" />
			<fileset refid="jboss-lib-jar-fileset" />
			<fileset refid="all-project-lib-flattened-jar-fileset" />
			<fileset dir="${project.lib}" includes="${client.graphing.device.qc.plot.jdbc.jar}" />
		</zip>
		<!-- Just so the files are HTTP accessible, copy all of them without zipping them -->

		<!-- Deploy the metadata schema too -->
		<copy file="${project.src}/xml/SSDS_Metadata.xsd" todir="${project.documentation.deploy.location}/xml/schema" overwrite="true" />
		<!-- Go ahead and deploy the static doc index page -->
		<copy file="${src.resources}/build/doc/index.html" todir="${project.documentation.deploy.location}" overwrite="true" />
	</target>

	<!-- This target removes the services application from the deployed configuration -->
	<target name="undeploy" depends="init">
		<!-- Remove the security configuration files -->
		<delete file="${security.config.deployment.location}/ssds-login-config.xml" />
		<delete file="${security.config.service.deployment.location}/ssds-login-config-service.xml" />
		<!-- Remove the mail configuration -->
		<delete file="${core.mail.deployment.location}/mail-service.xml" />
		<!-- Remove the metadata jars and xml files -->
		<delete file="${jboss.home}/server/${jboss.server.type}/lib/${metadata.datasource.jdbc.jar}" />
		<delete file="${jboss.home}/server/${jboss.server.type}/lib/${blazeds.flex.tomcat.common.jar}" />
		<delete file="${jboss.home}/server/${jboss.server.type}/lib/${blazeds.flex.tomcat.server.jar}" />
		<delete file="${jboss.home}/server/${jboss.server.type}/deploy/ssds-data-ds.xml" />
		<delete file="${jboss.home}/server/${jboss.server.type}/deploy/ssds-metadata-ds.xml" />
		<delete file="${jboss.home}/server/${jboss.server.type}/deploy/ssds.ear" />
		<delete file="${project.documentation.deploy.location}/client/ssds-services-metadata-client.zip" />
		<!-- Remove web services war -->
		<delete file="${jboss.home}/server/${jboss.server.type}/deploy/axis.war" />
		<!-- Remove the graphing jar -->
		<delete file="${project.documentation.deploy.location}/client/ssds-graphing-client.zip" />
		<!-- UpdateBot jar -->
		<delete file="${project.documentation.deploy.location}/client/ssds-updatebot-client.zip" />
		<!-- Remove the XML schema -->
		<delete file="${project.documentation.deploy.location}/xml/schema/SSDS_Metadata.xsd" />
	</target>
</project>
